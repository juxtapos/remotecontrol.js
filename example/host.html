<!DOCTYPE html>
<html>
<head>
	<title>remotecontrol.js: host application</title>
	<link rel="stylesheet" href="dist/remotecontrol.js.css" />
	<link rel="stylesheet" href="host.css" />
	<script src="dist/socket.io.min.js"></script>
	<script src="dist/remotecontrol.js.host.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<style>
	#rcjscursor {
		width: 20px;
		height: 20px;
		border-radius: 10px;
		background-color: rgba(255, 255, 255, 0.4);
		border: 1px solid black;
		position: absolute;
		top: 10px;
		left: 10px;
		z-index: 999;
		display: none;
	}
	</style>

	<script>

	document.addEventListener('DOMContentLoaded', function () {
		var rch = init();

		for (var i = 10; i--;) {
			$(document.body).append('<div class="box">&nbsp;</div>');
		}
	});

	function init (options) {
		var	rch = new RemoteControlHost({ 
				host: 'cumulus.local', 
				port: 1337,
				capture: [
					'MSPointerUp',
					'MSPointerMove',
					'MSPointerDown',
					'touchstart', 
					'touchmove',
					'touchend',
					'mousedown',
					'mousemove',
					'mouseup'
				]
			});

		document.querySelector('#remotecontrol button').addEventListener('click', function () { 
			rch.requestToken();
		});

		rch.addEventListener('rcjs:token', function (data) {
			document.querySelector('#remotecontrol .tokenDisplay').innerHTML = data.tokenId;
		});

		Cursor(rch);

		function Cursor(rch) {
			$('<div id="rcjscursor"></div>').appendTo(document.body);
			var mouseStartDelta;
			var currentCursorTarget;

			function up (event) {
				mouseStartDelta = null;
				$('#rcjscursor').hide();
			}

			function down (event) {
				console.log('down');
				$('#rcjscursor').show();
				var curpos = $('#rcjscursor').position();
				mouseStartDelta = { x: event.clientX - curpos.left, y: event.clientY - curpos.top };
			}

			function move (event) {
				console.log(event.clientX);
				if (mouseStartDelta) {
					$('#rcjscursor').css( { 
						left: event.clientX - mouseStartDelta.x + 'px', 
						top: event.clientY - mouseStartDelta.y + 'px' 
					} );
					$('#rcjscursor').toggle();
					var target;
					if ( ( target = document.elementFromPoint(event.clientX - mouseStartDelta.x, 
							event.clientY - mouseStartDelta.y ) ) ) {
						$('#rcjscursor').toggle();	
						$(target).addClass('focused');
						if (currentCursorTarget && currentCursorTarget != target) { 
							$(currentCursorTarget).removeClass('focused');
						}
						currentCursorTarget = target;
					} else {
						$('#rcjscursor').toggle();	
					}
				}
			}

			rch.addEventListener('mouseup', up);
			rch.addEventListener('touchstart', up);
			rch.addEventListener('mousemove', move);
			rch.addEventListener('touchmove', move);
			rch.addEventListener('mousedown', down);
			rch.addEventListener('touchend', down);
		}
	}
	</script>
	<style>
	
	</style>
</head>
<body>
	<div class="remotecontrol" id="remotecontrol">
		<div class="title">remotecontrol.js</div>
		<button>Get Token</button>
		<div class="tokenDisplay"></div>
	</div>
</body>
</html>