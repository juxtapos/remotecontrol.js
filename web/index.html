<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>remotecontrol.js</title>
    <link href='http://fonts.googleapis.com/css?family=Syncopate:400,700' rel='stylesheet' type='text/css'>
    <!--<link href='http://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>-->
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <link rel="stylesheet" href="css/remotecontrol-ui.css" type="text/css">
    <link rel="stylesheet" href="css/scenarios.css" type="text/css">
    <script src="js/prefixfree.min.js"></script>
    <script src="js/socket.io.min.js"></script>
    <script src="js/events.js"></script>
    <script src="js/remotecontrol.js.host.js"></script>
    <script src="js/scenarios.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/jquery-ui.min.js"></script>
    <script>
    
    $(document).ready(function () {
        init('Scenario1');
    });
    
    function init (scenario) {
        var rch;
        var currentScenarioName = scenario, currentScenario;

        function selectScenario (scenario) { 
            $('#scenarios').removeClass('on');
            $('#scenarioSelect').attr('disabled', 'disabled');
            (function (scenario) {
                window.setTimeout(function () {
                    $('#scenarios .stage').removeClass(currentScenarioName);
                    $('#scenarios .stage').empty().addClass(scenario);
                    $('#scenarios').addClass('on');
                    var scenarioObj = new window[scenario](rch);
                    scenarioObj.init($('#scenarios .stage'));

                    var desc = window[scenario].description.replace(/\u000a\u000a/g, "<br><br>");
                    $('#scenarioDescription').empty().append('<h1>' + window[scenario].title + '</h1>')
                        .append('<p>' + desc + '</p>');
                    if (currentScenario instanceof ScenarioBase) {
                        currentScenario.destroy();
                    }
                    currentScenarioName = scenario;
                    currentScenario = scenarioObj;
                    $('#scenarioSelect').removeAttr('disabled');
                }, 1000);
            })(scenario);
        }

        rch = new RemoteControlHost({ 
                host: location.host, 
                port: 1337,
                capture: [
                    //'MSPointerUp',
                    //'MSPointerMove',
                    //'MSPointerDown',
                    'touchstart', 
                    'touchmove',
                    'touchend',
                    'mousedown',
                    'mousemove',
                    'mouseup',
                    'deviceorientation',
                    'devicemotion'
                ],
                pointerMode : true
            });

        $('#getTokenButton').on('click', function () { 
            rch.requestToken();
        });

        rch.addEventListener('rcjs:token', function (data) {
            $('#getTokenButton span').empty().append(data.tokenId);
            // Remove the displayed token after token TTL was reached. 
            window.setTimeout(function () {
                $('#getTokenButton span').empty();
            }, 60000);
        });

        // Search for scenarios, that is currently global functions whose names are 'ScenarioN', 
        // where N is continuous number from 1..n. 
        var foundScenario, idx = 1, slctd;
        do {
            foundScenario = false
            if (window['Scenario' + idx]) {
                var scene = window['Scenario' + idx];
                slctd = 'Scenario' + idx == currentScenarioName ? 'selected' : '';
                $('#scenarioSelect').append('<option value="Scenario' + idx  + '" ' + slctd + '>' + scene.title + '</option>');
                foundScenario = true;
            }
            idx += 1;
        } while(foundScenario);

        document.querySelector('#scenarioSelect').addEventListener('change', function (event) {
            selectScenario(event.target.value);
        });

        selectScenario(currentScenarioName);
        rch.requestToken();
    }
    </script>
</head>
<body>
	
    <div id="sidebar">
        <div>
            <div class="description">What's This About?</div>
            <p>remotecontrol.js is an experiment to use gestures, touches and other events like orientation and motion 
                from mobile devices in web applications on the desktop. After coupling a mobile device to an application, 
                its range of additional events can be used to augment the opportunities for human-computer interaction.</p>
        </div>
        <div>
            <div class="description">Get Token</div>
            <p>Click the button to get a fresh token to enter on your mobile device. I've already done that for you. The 
                token times out after 1 minute.</p>
            <div class="remotecontrol" id="remotecontrol">
                <label>remotecontrol.js</label>
                <p></p>
                <button id="getTokenButton"><img src="images/reload.png" width="18"/><span>Token</span></button>
            </div>
        </div>
        <div id="scenarioSelectBox">
            <div class="description">Select Demo Scenario</div>
            <select id="scenarioSelect"></select>    
        </div>
        <div id="scenarioDescription"></div>
        <!--<div id="compatNote">
            <p><strong>Compatibility:</strong></p>
            <p>The demo application should run on a decent Chrome and Firefox browser.
                Internet Explorer support is coming.</p>
            <p>The remote controller application was tested on Safari Mobile 5, it should
                however run on any recent Webkit-based browser.</p>
        </div>-->
    </div>
    <div id="scenarios">
        <div class="stage"></div>
    </div>

    <a href="https://github.com/juxtapos/remotecontrol.js"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
</body>
</html>