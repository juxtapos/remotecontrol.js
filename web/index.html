<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>remotecontrol.js</title>
    <!--<link href='http://fonts.googleapis.com/css?family=Syncopate:400,700' rel='stylesheet' type='text/css'>-->
    <!--<link href='http://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>-->
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <script src="js/socket.io.min.js"></script>
    <script src="js/events.js"></script>
    <script src="js/remotecontrol.js.host.js"></script>
    <script src="js/scenarios.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/jquery-ui.min.js"></script>
    <script>
    
    $(document).ready(function () {
        init('Scenario4');
    });
    
    function init (scenario) {
        var rch;
        var currentScenario = scenario;

        function selectScenario (scenario) { 
            $('#scenarios').removeClass('on');
            (function (scenario) {
                window.setTimeout(function () {
                    $('#scenarios .stage').removeClass(currentScenario);
                    $('#scenarios .stage').empty().addClass(scenario);
                    $('#scenarios').addClass('on');
                    var scenarioObj = new window[scenario](rch);
                    scenarioObj.init($('#scenarios .stage'));
                    var desc = window[scenario].description.replace(/\u000a\u000a/g, "<br><br>");
                    $('#scenarioDescription').empty().append('<h1>' + window[scenario].title + '</h1>')
                        .append('<p>' + desc + '</p>');
                    currentScenario = scenario;
                }, 1000);
            })(scenario);
        }

        rch = new RemoteControlHost({ 
                host: location.host, 
                port: 1337,
                capture: [
                    //'MSPointerUp',
                    //'MSPointerMove',
                    //'MSPointerDown',
                    'touchstart', 
                    'touchmove',
                    'touchend',
                    'mousedown',
                    'mousemove',
                    'mouseup',
                    //'deviceorientation',
                    //'devicemotion'
                ],
                pointerMode : true
            });

        document.querySelector('#getTokenButton').addEventListener('click', function () { 
            rch.requestToken();
        });

        rch.addEventListener('rcjs:token', function (data) {
            document.querySelector('#remotecontrol .tokenDisplay').innerHTML = data.tokenId;
        });

        var foundScenario, idx = 1, slctd;
        do {
            foundScenario = false
            if (window['Scenario' + idx]) {
                var scene = window['Scenario' + idx];
                slctd = 'Scenario' + idx == currentScenario ? 'selected' : '';
                $('#scenarioSelect').append('<option value="Scenario' + idx  + '" ' + slctd + '>' + scene.title + '</option>');
                foundScenario = true;
            }
            idx += 1;
        } while(foundScenario);

        document.querySelector('#scenarioSelect').addEventListener('change', function (event) {
            selectScenario(event.target.value);
        });

        selectScenario(currentScenario);
    }
    </script>
</head>
<body>
	<div class="remotecontrol" id="remotecontrol">
        <label>remotecontrol.js</label>
        <p>Click the button to get a fresh token to enter on your mobile device</p>
        <button id="getTokenButton">
            <img src="images/reload.png" width="18"/><span>Token</span></button>
        <div class="tokenDisplay">&lt;token&gt;</div>
        <p style="font-size:100%">Select demo scenario</p>
        <select id="scenarioSelect"></select>
	</div>
    <div id="sidebar">
        <div id="scenarioDescription"></div>
    </div>
    <div id="scenarios">
        <div class="stage"></div>
    </div>
</body>
</html>