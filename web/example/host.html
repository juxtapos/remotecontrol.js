<!DOCTYPE html>
<html>
<head>
	<title>remotecontrol.js: Examples</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<link rel="stylesheet" href="remotecontrol.js.css">
	<link rel="stylesheet" href="host.css">

	<script src="socket.io.min.js"></script>
	<script src="../js/remotecontrol.js.host.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

	<script>
	document.addEventListener('DOMContentLoaded', init, false);

	function init (options) {
		for (var i = 10; i--;) {
			$(document.body).append('<div class="box">&nbsp;</div>');
		}

		var	rch = new RemoteControlHost({ 
				host: '127.0.0.1', 
				port: 1337,
				capture: [
					'MSPointerUp',
					'MSPointerMove',
					'MSPointerDown',
					'touchstart', 
					'touchmove',
					'touchend',
					'mousedown',
					'mousemove',
					'mouseup'
				]
			});

		document.querySelector('#remotecontrol button').addEventListener('click', function () { 
			rch.requestToken();
		});

		rch.addEventListener('rcjs:token', function (data) {
			document.querySelector('#remotecontrol .tokenDisplay').innerHTML = data.tokenId;
		});

		Cursor(rch);

		function Cursor(rch) {
			var mouseStartDelta, currentCursorTarget, cursorId = 'rcjscursor', cursor;

			cursorElmnt = $('<div class="rcjscursor" id="' + cursorId + '"></div>').appendTo(document.body);

			function getCoordinates (event) {
				switch (event.type) {
					case 'touchstart':
					case 'touchmove': 
						return {
							x: event.touches[0].clientX,
							y: event.touches[0].clientY	
						}
					case 'mousedown':
					case 'mousemove':
						return {
							x: event.clientX,
							y: event.clientY	
						}
					default: 
						return null;
				}
			}

			function up (event) {
				mouseStartDelta = null;
				cursorElmnt.hide();
			}

			function down (event) {
				cursorElmnt.show();
				var curpos = cursorElmnt.position(),
					coords = getCoordinates(event);
				mouseStartDelta = { x: coords.x - curpos.left, y: coords.y - curpos.top };
			}

			function move (event) {
				var x, y, target, coords = getCoordinates(event);
				
				if (mouseStartDelta) {
					cursorElmnt.css( { 
						left: coords.x - mouseStartDelta.x + 'px', 
						top: coords.y - mouseStartDelta.y + 'px' 
					} );

					// Hide the cursor before getting elementFromPoint, so we don't get the
					// cursor itself.
					cursorElmnt.toggle();
					if ( ( target = document.elementFromPoint(coords.x - mouseStartDelta.x, 
							coords.y - mouseStartDelta.y ) ) ) {
						cursorElmnt.toggle();	
						$(target).addClass('focused');
						if (currentCursorTarget && currentCursorTarget != target) { 
							$(currentCursorTarget).removeClass('focused');
						}
						currentCursorTarget = target;
					} else {
						cursorElmnt.toggle();	
					}
				}
			}

			rch.addEventListener('mousedown', down);
			rch.addEventListener('touchstart', down);
			rch.addEventListener('mouseup', up);
			rch.addEventListener('touchend', up);
			rch.addEventListener('mousemove', move);
			rch.addEventListener('touchmove', move);
		}
	}
	</script>
	<style>
	
	</style>
</head>
<body>
	<div class="remotecontrol" id="remotecontrol">
		<div class="title">remotecontrol.js</div>
		<button>Get Token</button>
		<div class="tokenDisplay"></div>
	</div>
</body>
</html>